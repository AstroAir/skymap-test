# 离线功能

SkyMap Test 支持离线使用，让您在没有网络的观测现场也能正常使用。

## 功能概览

### 离线数据类型

- **星图瓦片** - HiPS 巡天图像缓存
- **天体目录** - DSO 星表数据
- **卫星数据** - TLE 轨道数据
- **天体信息** - 查询过的天体详情

### 缓存特性

- **智能预取** - 自动缓存常用数据
- **区域下载** - 按天区批量下载
- **过期管理** - 自动清理过期数据
- **空间管理** - 监控和控制缓存大小

## 缓存管理器

### 打开方式

1. 点击设置菜单
2. 选择 "离线缓存"
3. 或使用快捷键 `Ctrl+Shift+C`

### 缓存统计

缓存管理器显示以下信息：

- **总缓存大小** - 所有缓存数据占用空间
- **瓦片缓存** - 星图图像占用空间
- **数据缓存** - 天体信息占用空间
- **命中率** - 缓存命中百分比

## 星图瓦片缓存

### 自动缓存

浏览星图时，查看过的区域会自动缓存：

- 缓存当前视野内的瓦片
- 根据缩放级别缓存不同分辨率
- 使用 LRU 策略管理缓存

### 区域预下载

为特定观测区域预先下载瓦片：

1. 在星图上定位到目标区域
2. 打开缓存管理器
3. 点击 "缓存当前区域"
4. 选择缓存半径和深度
5. 开始下载

#### 下载选项

| 选项 | 说明 |
|------|------|
| 半径 | 缓存区域的角度半径（1°-30°） |
| 深度 | 最大缩放级别（影响分辨率） |
| 巡天 | 选择要缓存的数据源 |

### 缓存区域管理

- **查看区域** - 列出所有已缓存的区域
- **更新区域** - 重新下载区域数据
- **删除区域** - 移除指定区域缓存

## 数据缓存

### 天体信息缓存

查询过的天体信息会自动缓存：

- SIMBAD 查询结果
- 维基百科摘要
- 图像数据

### 缓存有效期

不同类型数据有不同的过期时间：

| 数据类型 | 有效期 |
|----------|--------|
| 星图瓦片 | 30 天 |
| 天体信息 | 7 天 |
| 卫星 TLE | 1 天 |
| 天文事件 | 1 天 |

## 离线模式

### 启用离线模式

1. 打开设置
2. 选择 "网络"
3. 开启 "离线模式"

启用后：

- 不会发起网络请求
- 仅使用本地缓存数据
- 未缓存的数据显示为不可用

### 离线模式指示

状态栏显示当前网络状态：

- 🟢 在线 - 正常网络连接
- 🟡 受限 - 部分功能离线
- 🔴 离线 - 完全离线模式

## 缓存清理

### 自动清理

系统定期自动清理：

- 过期的缓存数据
- 长时间未访问的数据
- 超出配额的旧数据

### 手动清理

在缓存管理器中：

- **清理过期** - 仅清理过期数据
- **清理指定类型** - 清理特定类型缓存
- **清理全部** - 清空所有缓存

> **警告**：清理缓存后，相关数据需要重新下载。

## 存储配置

### 缓存位置

缓存数据存储在应用数据目录：

- **Windows**: `%APPDATA%\skymap-test\cache`
- **macOS**: `~/Library/Application Support/skymap-test/cache`
- **Linux**: `~/.local/share/skymap-test/cache`

### 配额设置

设置最大缓存空间：

1. 打开缓存管理器
2. 点击 "配置"
3. 设置最大缓存大小
4. 保存设置

推荐配额：

- **最小**: 500 MB
- **推荐**: 2 GB
- **充裕**: 10 GB+

## 最佳实践

### 观测前准备

1. 确定观测目标区域
2. 预下载相关区域瓦片
3. 查询并缓存目标天体信息
4. 更新卫星 TLE 数据

### 存储空间管理

- 定期清理不常用的缓存
- 删除过期的区域缓存
- 监控缓存空间使用

## 快捷操作

| 操作 | 快捷键 |
|------|--------|
| 打开缓存管理器 | `Ctrl+Shift+C` |
| 缓存当前区域 | `Ctrl+Shift+D` |
| 切换离线模式 | `Ctrl+Shift+O` |

---

返回：[用户指南](../index.md)
