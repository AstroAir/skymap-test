# 安全特性 (Security Features)

SkyMap 包含多层安全防护机制，旨在保护用户数据并防止恶意滥用。

## 1. 速率限制 (Rate Limiting)

后端实现了一个基于滑动窗口算法的速率限制器，防止命令滥用和简单的拒绝服务 (DoS) 攻击。

### 限制级别

根据命令的敏感程度和预期使用频率，分为四个限制级别：

- **保守级别 (Conservative)**: 10 次/分钟。适用于文件操作、数据导入导出（如 `open_path`, `import_all_data`）。
- **中等级别 (Moderate)**: 100 次/分钟。适用于常规存储操作（如 `save_store_data`, `save_cached_tile`）。
- **宽松级别 (Permissive)**: 1000 次/分钟。适用于高频缓存操作（如 `prefetch_url`, `load_cached_tile`）。
- **只读级别 (Read-Only)**: 10000 次/分钟。适用于低开销的只读信息查询。

### 自动惩罚

对于“保守级别”的命令，如果用户持续触发限制，系统会自动实施临时封禁。

---

## 2. 输入验证 (Input Validation)

后端在处理数据前会执行严格的验证。

### 大小验证

防止内存和磁盘耗尽攻击：
- **JSON 存储**: 单个文件最大 10MB。
- **星图瓦片**: 单张图片最大 5MB。
- **CSV 导入**: 最大 50MB 且不超过 100,000 行。

### URL 验证

防止服务端请求伪造 (SSRF)：
- **禁止私有 IP**: 阻止访问 192.168.x.x, 10.x.x.x 等内部网络。
- **禁止本地回环**: 阻止访问 localhost, 127.0.0.1 等。
- **HTTPS 强制**: 默认仅允许 HTTPS 协议。
- **危险协议拦截**: 阻止 file://, data://, javascript: 等协议。

---

## 3. 存储安全

- **路径沙箱**: 存储模块仅允许访问应用程序专用的数据目录，防止路径穿越攻击。
- **JSON 格式校验**: 所有写入的数据在保存前都会进行反序列化校验，确保数据完整性。

---

## 4. 运行安全检查

项目配置了完整的安全测试套件：
- `cargo test security_tests`: 验证 URL 验证器、大小验证器和速率限制器的正确性。
